<div class="p-4">
  <!-- Stats Overview -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <p-card styleClass="border-0 shadow-sm">
      <div class="flex items-center">
        <i class="ri-user-line text-3xl mr-3 text-blue-500"></i>
        <div>
          <h3 class="text-xl font-semibold">{{userStats.totalUsers}}</h3>
          <p class="text-gray-600">Total Users</p>
        </div>
      </div>
    </p-card>

    <p-card styleClass="border-0 shadow-sm">
      <div class="flex items-center">
        <i class="ri-user-add-line text-3xl mr-3 text-green-500"></i>
        <div>
          <h3 class="text-xl font-semibold">{{userStats.activeUsers}}</h3>
          <p class="text-gray-600">Active Users</p>
        </div>
      </div>
    </p-card>

    <p-card styleClass="border-0 shadow-sm">
      <div class="flex items-center">
        <i class="ri-time-line text-3xl mr-3 text-orange-500"></i>
        <div>
          <h3 class="text-xl font-semibold">{{userStats.pendingUsers}}</h3>
          <p class="text-gray-600">Pending Approvals</p>
        </div>
      </div>
    </p-card>

    <p-card styleClass="border-0 shadow-sm">
      <div class="flex items-center">
        <i class="ri-shield-keyhole-line text-3xl mr-3 text-purple-500"></i>
        <div>
          <h3 class="text-xl font-semibold">{{userStats.onlineUsers}}</h3>
          <p class="text-gray-600">Online Now</p>
        </div>
      </div>
    </p-card>
  </div>

  <!-- User List -->
  <p-card styleClass="shadow-sm">
    <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6">
      <h2 class="text-2xl font-bold text-gray-800">User Management</h2>
      <div class="flex gap-2">
        <p-button 
          label="Import Users" 
          icon="ri-file-upload-line"
          severity="secondary"
          styleClass="p-button-rounded"
          (onClick)="showImportDialog()">
        </p-button>
        <p-button 
          label="Add User" 
          icon="ri-user-add-line"
          styleClass="p-button-rounded"
          (onClick)="showUserDialog()">
        </p-button>
      </div>
    </div>

    <!-- Filters -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <span class="p-input-icon-left w-full">
        <i class="ri-search-line"></i>
        <input 
          pInputText 
          type="text" 
          [(ngModel)]="filters.search"
          (input)="onSearch($event)"
          placeholder="Search users..."
          class="w-full rounded-lg" />
      </span>

      <p-dropdown 
        [options]="roles"
        [(ngModel)]="filters.role"
        (onChange)="filterUsers()"
        placeholder="Select Role"
        [showClear]="true"
        styleClass="w-full">
      </p-dropdown>

      <p-dropdown 
        [options]="departments"
        [(ngModel)]="filters.department"
        (onChange)="filterUsers()"
        placeholder="Select Department"
        [showClear]="true"
        styleClass="w-full">
      </p-dropdown>

      <p-dropdown 
        [options]="statuses"
        [(ngModel)]="filters.status"
        (onChange)="filterUsers()"
        placeholder="Select Status"
        [showClear]="true"
        styleClass="w-full">
      </p-dropdown>
    </div>

    <p-table 
      #dt
      [value]="users" 
      [rows]="10" 
      [paginator]="true"
      [loading]="loading"
      [rowHover]="true"
      styleClass="p-datatable-rounded p-datatable-gridlines"
      dataKey="id"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} users"
      [rowsPerPageOptions]="[10,25,50]"
      [globalFilterFields]="['firstName','lastName','email','role','department']">

      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="firstName" class="text-left">
            User <p-sortIcon field="firstName"></p-sortIcon>
          </th>
          <th pSortableColumn="role" class="text-left">
            Role <p-sortIcon field="role"></p-sortIcon>
          </th>
          <th pSortableColumn="department" class="text-left">
            Department <p-sortIcon field="department"></p-sortIcon>
          </th>
          <th pSortableColumn="status" class="text-left">
            Status <p-sortIcon field="status"></p-sortIcon>
          </th>
          <th pSortableColumn="lastLogin" class="text-left">
            Last Login <p-sortIcon field="lastLogin"></p-sortIcon>
          </th>
          <th class="text-center">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-user>
        <tr>
          <td>
            <div class="flex items-center">
              <p-avatar 
                [image]="user.profileImage" 
                [label]="getUserInitials(user)"
                styleClass="mr-2"
                [ngClass]="user.role === 'SUPER_ADMIN' ? 'bg-purple-600' : 'bg-blue-600'"
                shape="circle"
                [style]="{'width': '36px', 'height': '36px'}">
              </p-avatar>
              <div>
                <div class="font-medium">
                  {{user.firstName}} {{user.lastName}}
                </div>
                <div class="text-sm text-gray-500">{{user.email}}</div>
              </div>
            </div>
          </td>
          <td>
            <span [class]="getRoleClass(user.role)">
              {{user.role.replace('_', ' ')}}
            </span>
          </td>
          <td>{{user.department}}</td>
          <td>
            <span [class]="getStatusClass(user.status)">
              {{user.status | titlecase}}
            </span>
          </td>
          <td>
            <div class="text-sm">
              {{user.lastLogin | date:'MMM d, y, h:mm a'}}
            </div>
          </td>
          <td>
            <div class="flex justify-center gap-2">
              <p-button 
                icon="ri-eye-line" 
                severity="secondary"
                styleClass="p-button-rounded p-button-text"
                (onClick)="viewUser(user)"
                pTooltip="View Details">
              </p-button>
              <p-button 
                icon="ri-edit-line" 
                severity="secondary"
                styleClass="p-button-rounded p-button-text"
                (onClick)="editUser(user)"
                pTooltip="Edit User">
              </p-button>
              <p-button 
                icon="ri-lock-line" 
                severity="secondary"
                styleClass="p-button-rounded p-button-text"
                (onClick)="resetPassword(user)"
                pTooltip="Reset Password">
              </p-button>
              <p-button 
                [icon]="user.status === 'active' ? 'ri-lock-line' : 'ri-lock-unlock-line'"
                [severity]="user.status === 'active' ? 'danger' : 'success'"
                styleClass="p-button-rounded p-button-text"
                (onClick)="toggleUserStatus(user)"
                [pTooltip]="user.status === 'active' ? 'Block User' : 'Activate User'">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center p-6">
            <div class="flex flex-col items-center">
              <i class="ri-user-search-line text-4xl text-gray-400 mb-2"></i>
              <span class="text-gray-500">No users found.</span>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <!-- User Dialog -->
  <p-dialog 
    [(visible)]="displayUserDialog" 
    [header]="selectedUser ? 'Edit User' : 'Add New User'"
    [modal]="true"
    [style]="{width: '650px'}"
    [draggable]="false"
    styleClass="p-dialog-rounded">
    <!-- User Form -->
    <div class="text-center p-4">
      <i class="ri-user-settings-line text-5xl text-gray-400 mb-2"></i>
      <p>User form would go here</p>
    </div>
  </p-dialog>

  <!-- Import Dialog -->
  <p-dialog 
    [(visible)]="displayImportDialog" 
    header="Import Users"
    [modal]="true"
    [style]="{width: '450px'}"
    [draggable]="false"
    styleClass="p-dialog-rounded">
    <!-- Import Form -->
    <div class="text-center p-4">
      <i class="ri-file-upload-line text-5xl text-gray-400 mb-2"></i>
      <p>Import form would go here</p>
    </div>
  </p-dialog>

  <!-- View User Dialog -->
  <p-dialog 
    [(visible)]="displayViewDialog" 
    [header]="selectedUser ? selectedUser.firstName + ' ' + selectedUser.lastName : ''"
    [modal]="true"
    [style]="{width: '800px'}"
    [draggable]="false"
    styleClass="p-dialog-rounded">
    <!-- User Details View -->
    <div *ngIf="selectedUser" class="p-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="flex flex-col items-center text-center">
          <p-avatar 
            [image]="selectedUser.profileImage" 
            [label]="getUserInitials(selectedUser)"
            [ngClass]="selectedUser.role === 'SUPER_ADMIN' ? 'bg-purple-600' : 'bg-blue-600'"
            shape="circle"
            size="xlarge"
            class="mb-4">
          </p-avatar>
          <h3 class="text-xl font-bold">{{selectedUser.firstName}} {{selectedUser.lastName}}</h3>
          <p class="text-gray-600">{{selectedUser.email}}</p>
          <span [class]="getRoleClass(selectedUser.role)" class="mt-2">
            {{selectedUser.role.replace('_', ' ')}}
          </span>
        </div>
        <div>
          <h4 class="text-lg font-semibold mb-4">User Information</h4>
          <div class="grid grid-cols-1 gap-3">
            <div class="flex justify-between py-2 border-b border-gray-200">
              <span class="text-gray-600">Department:</span>
              <span class="font-medium">{{selectedUser.department}}</span>
            </div>
            <div class="flex justify-between py-2 border-b border-gray-200">
              <span class="text-gray-600">Status:</span>
              <span [class]="getStatusClass(selectedUser.status)">
                {{selectedUser.status | titlecase}}
              </span>
            </div>
            <div class="flex justify-between py-2 border-b border-gray-200">
              <span class="text-gray-600">Last Login:</span>
              <span>{{selectedUser.lastLogin | date:'medium'}}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </p-dialog>

  <!-- Reset Password Dialog -->
  <p-dialog 
    [(visible)]="displayResetDialog" 
    header="Reset Password"
    [modal]="true"
    [style]="{width: '400px'}"
    [draggable]="false"
    styleClass="p-dialog-rounded">
    <!-- Reset Password Form -->
    <div class="p-4 text-center">
      <i class="ri-lock-password-line text-5xl text-gray-400 mb-2"></i>
      <p>Password reset form would go here</p>
    </div>
  </p-dialog>

  <p-confirmDialog styleClass="p-dialog-rounded"></p-confirmDialog>
  <p-toast></p-toast>
</div>