<div class="p-4 max-w-7xl mx-auto">
  <p-toast></p-toast>

  <p-card [style]="{'border-radius': '8px', 'box-shadow': '0 4px 6px rgba(0, 0, 0, 0.1)'}">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-gray-800">
        {{isEditMode ? 'Edit Department' : 'Add New Department'}}
      </h2>
      <p-button icon="ri-arrow-left-line" label="Back" severity="secondary" (onClick)="goBack()" [style]="{'border-radius': '4px'}"></p-button>
    </div>

    <div *ngIf="loading" class="flex justify-center p-10">
      <i class="ri-loader-4-line animate-spin text-4xl text-gray-500"></i>
    </div>

    <form *ngIf="!loading" [formGroup]="departmentForm" (ngSubmit)="onSubmit()" class="space-y-6">
      <!-- Basic Information -->
      <div class="bg-gray-50 p-4 rounded-lg">
        <h3 class="text-lg font-medium mb-4 text-gray-700">
          <i class="ri-information-line mr-2"></i>Basic Information
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Department Name <span class="text-red-500">*</span>
            </label>
            <input pInputText formControlName="name" class="w-full" 
                   [ngClass]="{'ng-invalid ng-dirty': isFieldInvalid('name')}" />
            <small class="text-red-500" *ngIf="isFieldInvalid('name')">
              Department name is required
            </small>
          </div>

          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Department Code <span class="text-red-500">*</span>
            </label>
            <input pInputText formControlName="code" class="w-full" placeholder="e.g. CARD, ORTH, PEDI"
                   [ngClass]="{'ng-invalid ng-dirty': isFieldInvalid('code')}" />
            <small class="text-red-500" *ngIf="isFieldInvalid('code')">
              Department code is required
            </small>
          </div>

          <div class="field md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Description
            </label>
            <textarea pInputTextarea formControlName="description" rows="3" class="w-full resize-none"></textarea>
          </div>

          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Head of Department <span class="text-red-500">*</span>
            </label>
            <input pInputText formControlName="headOfDepartment" class="w-full"
                   [ngClass]="{'ng-invalid ng-dirty': isFieldInvalid('headOfDepartment')}" />
            <small class="text-red-500" *ngIf="isFieldInvalid('headOfDepartment')">
              Head of department is required
            </small>
          </div>
        </div>
      </div>

      <p-divider styleClass="my-4"></p-divider>

      <!-- Contact Information -->
      <div formGroupName="contactInfo" class="bg-gray-50 p-4 rounded-lg">
        <h3 class="text-lg font-medium mb-4 text-gray-700">
          <i class="ri-contacts-line mr-2"></i>Contact Information
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Email
            </label>
            <input pInputText formControlName="email" class="w-full" type="email" />
            <small class="text-red-500" *ngIf="departmentForm.get('contactInfo.email')?.invalid && departmentForm.get('contactInfo.email')?.touched">
              Please enter a valid email
            </small>
          </div>

          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Phone
            </label>
            <input pInputText formControlName="phone" class="w-full" placeholder="e.g. +1 (555) 123-4567" />
          </div>

          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Emergency Contact
            </label>
            <input pInputText formControlName="emergencyContact" class="w-full" placeholder="e.g. +1 (555) 987-6543" />
          </div>
        </div>
      </div>

      <p-divider styleClass="my-4"></p-divider>

      <!-- Location Information -->
      <div formGroupName="location" class="bg-gray-50 p-4 rounded-lg">
        <h3 class="text-lg font-medium mb-4 text-gray-700">
          <i class="ri-map-pin-line mr-2"></i>Location
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Building
            </label>
            <input pInputText formControlName="building" class="w-full" placeholder="e.g. Main Building" />
          </div>

          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Floor
            </label>
            <p-inputNumber formControlName="floor" [showButtons]="false" class="w-full" inputStyleClass="w-full" placeholder="e.g. 3"></p-inputNumber>
          </div>

          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Room Numbers
            </label>
            <p-chips formControlName="roomNumbers" separator="," placeholder="Add rooms and press Enter" class="w-full"></p-chips>
          </div>
        </div>
      </div>

      <p-divider styleClass="my-4"></p-divider>

      <!-- Capacity Information -->
      <div formGroupName="capacity" class="bg-gray-50 p-4 rounded-lg">
        <h3 class="text-lg font-medium mb-4 text-gray-700">
          <i class="ri-hospital-line mr-2"></i>Capacity
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Total Beds <span class="text-red-500">*</span>
            </label>
            <p-inputNumber formControlName="totalBeds" [showButtons]="true" [min]="0" class="w-full" inputStyleClass="w-full"
                           [ngClass]="{'ng-invalid ng-dirty': isNestedFieldInvalid('capacity', 'totalBeds')}"></p-inputNumber>
            <small class="text-red-500" *ngIf="isNestedFieldInvalid('capacity', 'totalBeds')">
              Total beds is required
            </small>
          </div>

          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Current Occupancy <span class="text-red-500">*</span>
            </label>
            <p-inputNumber formControlName="currentOccupancy" [showButtons]="true" [min]="0" class="w-full" inputStyleClass="w-full"
                           [ngClass]="{'ng-invalid ng-dirty': isNestedFieldInvalid('capacity', 'currentOccupancy')}"></p-inputNumber>
            <small class="text-red-500" *ngIf="isNestedFieldInvalid('capacity', 'currentOccupancy')">
              Current occupancy is required
            </small>
          </div>

          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Staff Count <span class="text-red-500">*</span>
            </label>
            <p-inputNumber formControlName="staffCount" [showButtons]="true" [min]="0" class="w-full" inputStyleClass="w-full"
                           [ngClass]="{'ng-invalid ng-dirty': isNestedFieldInvalid('capacity', 'staffCount')}"></p-inputNumber>
            <small class="text-red-500" *ngIf="isNestedFieldInvalid('capacity', 'staffCount')">
              Staff count is required
            </small>
          </div>
        </div>
      </div>

      <p-divider styleClass="my-4"></p-divider>

      <!-- Schedule Information -->
      <div formGroupName="schedule" class="bg-gray-50 p-4 rounded-lg">
        <h3 class="text-lg font-medium mb-4 text-gray-700">
          <i class="ri-calendar-line mr-2"></i>Schedule
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Working Days
            </label>
            <p-multiSelect formControlName="workingDays" [options]="workingDays" optionLabel="label" optionValue="value" 
                          class="w-full" placeholder="Select working days"></p-multiSelect>
          </div>

          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Start Time
            </label>
            <p-calendar formControlName="startTime" [timeOnly]="true" hourFormat="12" [showTime]="true" 
                      inputStyleClass="w-full" [showIcon]="true"></p-calendar>
          </div>

          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              End Time
            </label>
            <p-calendar formControlName="endTime" [timeOnly]="true" hourFormat="12" [showTime]="true" 
                      inputStyleClass="w-full" [showIcon]="true"></p-calendar>
          </div>
        </div>
      </div>

      <p-divider styleClass="my-4"></p-divider>

      <!-- Facilities and Specialties -->
      <div class="bg-gray-50 p-4 rounded-lg">
        <h3 class="text-lg font-medium mb-4 text-gray-700">
          <i class="ri-service-line mr-2"></i>Facilities & Specialties
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Facilities
            </label>
            <p-chips formControlName="facilities" separator="," placeholder="Add facilities and press Enter" class="w-full"></p-chips>
            <small class="text-gray-500">e.g. X-Ray, MRI, Lab, ICU</small>
          </div>

          <div class="field">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Specialties
            </label>
            <p-chips formControlName="specialties" separator="," placeholder="Add specialties and press Enter" class="w-full"></p-chips>
            <small class="text-gray-500">e.g. Cardiology, Orthopedics, Pediatrics</small>
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-3 pt-6">
        <p-button label="Cancel" severity="secondary" (onClick)="goBack()" icon="ri-close-line" [style]="{'border-radius': '4px'}"></p-button>
        <p-button label="{{isEditMode ? 'Update' : 'Save'}} Department" type="submit" [loading]="submitting" 
                icon="{{isEditMode ? 'ri-save-line' : 'ri-add-line'}}" [style]="{'border-radius': '4px'}"></p-button>
      </div>
    </form>
  </p-card>
</div>